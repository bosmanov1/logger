<!DOCTYPE html>
<html>
<head>
    <title>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ {{ link_id }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
    <div class="container">
        <h1>üçâ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: {{ link_id }}</h1>
        
        <div class="section">
            <h2>üîó –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º–∞—è —Å—Å—ã–ª–∫–∞</h2>
            <div class="tracking-box">
                <input type="text" id="trackingUrl" value="{{ tracking_url }}" readonly>
                <button onclick="copyToClipboard()">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
            </div>
        </div>

        <div class="section">
            <h2>üó∫Ô∏è –ö–∞—Ä—Ç–∞ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤</h2>
            <div id="map"></div>
        </div>

        <div class="section">
            <h2>üìã –ò—Å—Ç–æ—Ä–∏—è –ø–æ—Å–µ—â–µ–Ω–∏–π</h2>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>–í—Ä–µ–º—è</th>
                            <th>–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ</th>
                            <th>–ë—Ä–∞—É–∑–µ—Ä</th>
                            <th>–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for log in logs %}
                        <tr>
                            <td class="user-id">{{ log[2] }}</td>
                            <td>{{ log[10] }}</td>
                            <td>{{ log[5] }}</td>
                            <td>{{ log[6] }}</td>
                            <td>
                                {% if log[8] is not none and log[9] is not none %}
                                    {{ "%.4f, %.4f"|format(log[8]|float, log[9]|float) }}
                                {% else %}
                                    ‚ùå –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script src="https://api-maps.yandex.ru/2.1/?apikey=16b0bf26-9eed-4f76-badc-52a9f942f9e5&lang=ru_RU"></script>
    <script>
    function copyToClipboard() {
        const copyText = document.getElementById("trackingUrl");
        copyText.select();
        document.execCommand("copy");
        alert("–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞: " + copyText.value);
    }

    ymaps.ready(() => {
        const map = new ymaps.Map('map', {
            center: [55.75, 37.61],
            zoom: 3,
            controls: ['zoomControl']
        });

        const colors = ['#ff0000', '#00ff00', '#0000ff', '#ffa500', '#800080'];
        
        {% for log in logs %}
            {% if log[8] is not none and log[9] is not none %}
                const placemark_{{ loop.index }} = new ymaps.Placemark(
                    [{{ log[8]|float }}, {{ log[9]|float }}],
                    {
                        balloonContent: `
                            <div class="balloon">
                                <h3>{{ log[2] }}</h3>
                                <p>üïí {{ log[10] }}</p>
                                <p>üåê {{ log[5] }} / {{ log[6] }}</p>
                            </div>
                        `
                    },
                    {
                        preset: 'islands#circleDotIcon',
                        iconColor: colors[{{ loop.index % 5 }}]
                    }
                );
                map.geoObjects.add(placemark_{{ loop.index }});
            {% endif %}
        {% endfor %}

        if (map.geoObjects.getLength() > 0) {
            map.setBounds(map.geoObjects.getBounds());
        }
    });
    </script>
</body>
</html>
